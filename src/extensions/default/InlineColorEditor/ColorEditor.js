// Generated by CoffeeScript 1.3.3
(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define(["helper/colors"],function(t){var n;return n=function(){function t(t,n,r){var i=this;this.element=t;this.callback=r!=null?r:null;this.buttonbarButtonClickHandler=e(this.buttonbarButtonClickHandler,this);this.opacityMouseupHandler=e(this.opacityMouseupHandler,this);this.opacityMousemoveHandler=e(this.opacityMousemoveHandler,this);this.opacityMousedownHandler=e(this.opacityMousedownHandler,this);this.hueMouseupHandler=e(this.hueMouseupHandler,this);this.hueMousemoveHandler=e(this.hueMousemoveHandler,this);this.hueMousedownHandler=e(this.hueMousedownHandler,this);this.satLumMouseupHandler=e(this.satLumMouseupHandler,this);this.satLumMousemoveHandler=e(this.satLumMousemoveHandler,this);this.satLumMousedownHandler=e(this.satLumMousedownHandler,this);this.setOutputType(this.hexTypeIndex);this.satLumBlock=$(this.element).children(".saturation-luminosity-block")[0];this.hueSlider=$(this.element).children(".hue-slider")[0];this.opacitySlider=$(this.element).children(".opacity-slider")[0];this.colorIndicator=$(this.element).children(".lower-controls").children(".color-indicator")[0];this.originalColorIndicator=$(this.colorIndicator).children(".original-color")[0];this.buttonBar=$(this.element).children(".lower-controls").children(".button-bar")[0];this.originalColor=n;$(this.satLumBlock).mousedown(this.satLumMousedownHandler);$(this.hueSlider).mousedown(this.hueMousedownHandler);$(this.opacitySlider).mousedown(this.opacityMousedownHandler);$(this.buttonBar).children("li").click(this.buttonbarButtonClickHandler);$(this.originalColorIndicator).css({background:this.originalColor});$(this.originalColorIndicator).click(function(){return i.parseColor(i.originalColor)});this.parseColor(n)}t.prototype.hexRegEx=/[a-f0-9]{6}|#[a-f0-9]{3}/i;t.prototype.rgbRegEx=/rgb\( ?\b([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])\b ?, ?\b([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])\b ?, ?\b([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])\b ?\)|rgba\( ?\b([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])\b ?, ?\b([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])\b ?, ?\b([0-9]{1,2}|1[0-9]{2}|2[0-4][0-9]|25[0-5])\b ?, ?\b(1|0|0\.[0-9]{1,3}) ?\)/i;t.prototype.hslRegEx=/hsl\( ?\b([0-9]{1,2}|[12][0-9]{2}|3[0-5][0-9]|360)\b ?, ?\b([0-9]{1,2}|100)\b% ?, ?\b([0-9]{1,2}|100)\b% ?\)|hsla\( ?\b([0-9]{1,2}|[12][0-9]{2}|3[0-5][0-9]|360)\b ?, ?\b([0-9]{1,2}|100)\b% ?, ?\b([0-9]{1,2}|100)\b% ?, ?\b(1|0|0\.[0-9]{1,3}) ?\)/;t.prototype.hexTypeIndex=0;t.prototype.rgbTypeIndex=1;t.prototype.hslTypeIndex=2;t.prototype.parseColor=function(e){var t,n,r;if(e.match(this.hexRegEx)){this.setOutputType(this.hexTypeIndex);if(e.match(/^#?[a-f0-9]{3}$/i)){e=e.replace("#","");n=e.split("");e=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]}this.color=Colors.ColorFromHex(e)}else if(e.match(this.hslRegEx)){this.setOutputType(this.hslTypeIndex);e=e.substring(e.indexOf("(")+1,e.indexOf(")"));e=e.replace(/( )/g,"");n=e.split(",");t=function(){var e,t,i;i=[];for(e=0,t=n.length;e<t;e++){r=n[e];i.push(this.parsePercentage(r))}return i}.call(this);this.color=Colors.ColorFromHSV(t[0],t[1],t[2]);t.length>3&&this.color.SetAlpha(t[3])}else if(e.match(this.rgbRegEx)){this.setOutputType(this.rgbTypeIndex);e=e.substring(e.indexOf("(")+1,e.indexOf(")"));e=e.replace(/( )/g,"");n=e.split(",");t=function(){var e,t,i;i=[];for(e=0,t=n.length;e<t;e++){r=n[e];i.push(this.parsePercentage(r))}return i}.call(this);this.color=Colors.ColorFromRGB(t[0],t[1],t[2]);t.length>3&&this.color.SetAlpha(t[3])}else{this.setOutputType(this.hexTypeIndex);this.color=Colors.ColorFromHex("#FFFFFF");this.originalColor="#FFFFFF";console.log(this.originalColor);$(this.originalColorIndicator).css({background:"#FFFFFF"})}return this.updateColor()};t.prototype.parsePercentage=function(e){t;var t;if(e.indexOf("%")!==-1){e=e.replace("%","");t=parseFloat(e)/100}else t=parseFloat(e);return t};t.prototype.updateColor=function(){var e,t;this.outputStringType===this.hexTypeIndex&&this.color.SetAlpha(1);$(this.satLumBlock).css("background","hsl("+this.color.Hue()+", 100%, 50%)");t="rgba("+this.color.Red()+","+this.color.Green()+","+this.color.Blue()+",0)";$(this.opacitySlider).children(".opacity-gradient").css({background:"-webkit-linear-gradient(top, "+this.color.HexString()+", "+t+")"});$(this.satLumBlock).children(".selector").css({left:String(this.color.Saturation()*100)+"%",bottom:String(this.color.Value()*100)+"%"});$(this.hueSlider).children(".selector").css({bottom:String(this.color.Hue()/360*100)+"%"});$(this.opacitySlider).children(".selector").css({bottom:String(this.color.Alpha()*100)+"%"});$(this.colorIndicator).children(".selected-color").css({background:"rgba("+this.color.Red()+","+this.color.Green()+","+this.color.Blue()+","+this.color.Alpha()+")"});switch(this.outputStringType){case this.hexTypeIndex:e=this.color.HexString();break;case this.rgbTypeIndex:e=""+this.color.Red()+","+this.color.Green()+","+this.color.Blue();this.color.Alpha()<1&&this.color.Alpha()>=0?e="rgba("+e+","+Math.round(this.color.Alpha()*100)/100+")":e="rgb("+e+")";break;case this.hslTypeIndex:e="hsla("+Math.round(this.color.Hue())+","+Math.round(this.color.Saturation()*100)+"%,"+Math.round(this.color.Value()*100)+"%,"+Math.round(this.color.Alpha()*100)/100+")"}if(this.callback)return this.callback(e)};t.prototype.setOutputType=function(e){this.outputStringType=e;$(this.buttonBar).children().removeClass("selected");return $($(this.buttonBar).children()[e]).addClass("selected")};t.prototype.satLumMousedownHandler=function(e){this.color.SetHSV(this.color.Hue(),e.offsetX/150,1-e.offsetY/150);this.updateColor();$(document).bind("mouseup",this.satLumMouseupHandler);return $(document).bind("mousemove",this.satLumMousemoveHandler)};t.prototype.satLumMousemoveHandler=function(e){var t,n,r,i;r=e.originalEvent.clientX-$(this.satLumBlock).offset().left;i=e.originalEvent.clientY-$(this.satLumBlock).offset().top;n=$(this.satLumBlock).width();t=$(this.satLumBlock).height();r=r>=n?n:r<0?0:r;i=i>=t?t:i<0?0:i;this.color.SetHSV(this.color.Hue(),r/150,1-i/150);return this.updateColor()};t.prototype.satLumMouseupHandler=function(e){$(document).unbind("mouseup",this.satLumMouseupHandler);return $(document).unbind("mousemove",this.satLumMousemoveHandler)};t.prototype.hueMousedownHandler=function(e){this.color.SetHSV((1-e.offsetY/150)*360,this.color.Saturation(),this.color.Value());this.updateColor();$(document).bind("mouseup",this.hueMouseupHandler);return $(document).bind("mousemove",this.hueMousemoveHandler)};t.prototype.hueMousemoveHandler=function(e){var t,n;n=e.originalEvent.clientY-$(this.hueSlider).offset().top;t=$(this.hueSlider).height();n=n>=t?t:n<0?0:n;this.color.SetHSV((1-n/t)*360,this.color.Saturation(),this.color.Value());return this.updateColor()};t.prototype.hueMouseupHandler=function(e){$(document).unbind("mouseup",this.hueMouseupHandler);return $(document).unbind("mousemove",this.hueMousemoveHandler)};t.prototype.opacityMousedownHandler=function(e){this.color.SetHSVA(this.color.Hue(),this.color.Saturation(),this.color.Value(),1-e.offsetY/150);this.updateColor();this.outputStringType===this.hexTypeIndex&&this.setOutputType(this.rgbTypeIndex);$(document).bind("mouseup",this.opacityMouseupHandler);return $(document).bind("mousemove",this.opacityMousemoveHandler)};t.prototype.opacityMousemoveHandler=function(e){var t,n;n=e.originalEvent.clientY-$(this.opacitySlider).offset().top;t=$(this.opacitySlider).height();n=n>=t?t:n<0?0:n;this.color.SetHSVA(this.color.Hue(),this.color.Saturation(),this.color.Value(),1-n/t);return this.updateColor()};t.prototype.opacityMouseupHandler=function(e){$(document).unbind("mouseup",this.opacityMouseupHandler);return $(document).unbind("mousemove",this.opacityMousemoveHandler)};t.prototype.buttonbarButtonClickHandler=function(e){var t,n;n=$(e.target).parent();t=$(this.buttonBar).children().index(n);this.setOutputType(t);return this.updateColor()};return t}()})}).call(this);