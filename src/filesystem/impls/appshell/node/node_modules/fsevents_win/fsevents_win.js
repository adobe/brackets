/*
*/

var util = require('util');
var events = require('events');

// link to native (C++) node_modules addon
var binding = require('./build/Release/fswatch_win');

module.exports = function(path) {
    // create node object and kick-off file watcher thread on this path
    var fsevents = new FSEvents(path);
    
    // process file change events emitted by node object
    fsevents.on('fsevent', function(path, action) {
        var info = {
            event:'unknown',
            path: path,
        };
        
        if (action === 1) {
            info.event = 'rename';
        } else {
            info.event = 'modified';
        }
                    
        fsevents.emit('change', path, info);
        fsevents.emit(info.event, path, info);
    });
        
    return fsevents;
};

var FSEvents = binding.FSEvents;
util.inherits(FSEvents, events.EventEmitter);